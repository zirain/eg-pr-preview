<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://zirain.github.io/eg-pr-preview/5-test-docs-preview/zh/latest/tasks/><link rel=alternate type=application/rss+xml href=https://zirain.github.io/eg-pr-preview/5-test-docs-preview/zh/latest/tasks/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/eg-pr-preview/5-test-docs-preview/favicons/favicon.ico><link rel=apple-touch-icon href=/eg-pr-preview/5-test-docs-preview/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/eg-pr-preview/5-test-docs-preview/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/eg-pr-preview/5-test-docs-preview/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/eg-pr-preview/5-test-docs-preview/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/eg-pr-preview/5-test-docs-preview/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/eg-pr-preview/5-test-docs-preview/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/eg-pr-preview/5-test-docs-preview/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/eg-pr-preview/5-test-docs-preview/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/eg-pr-preview/5-test-docs-preview/favicons/android-192x192.png sizes=192x192><title>任务 | Envoy Gateway</title>
<meta name=description content="通过任务学习 Envoy Gateway 实践。"><meta property="og:url" content="https://zirain.github.io/eg-pr-preview/5-test-docs-preview/zh/latest/tasks/"><meta property="og:site_name" content="Envoy Gateway"><meta property="og:title" content="任务"><meta property="og:description" content="通过任务学习 Envoy Gateway 实践。"><meta property="og:locale" content="zh"><meta property="og:type" content="website"><meta itemprop=name content="任务"><meta itemprop=description content="通过任务学习 Envoy Gateway 实践。"><meta itemprop=dateModified content="2025-01-12T21:35:44+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="任务"><meta name=twitter:description content="通过任务学习 Envoy Gateway 实践。"><link rel=preload href=/eg-pr-preview/5-test-docs-preview/scss/main.min.13dd8d11b772c2d11eac755eb5d2d8924f18f01762c20defa026366a1f00937d.css as=style><link href=/eg-pr-preview/5-test-docs-preview/scss/main.min.13dd8d11b772c2d11eac755eb5d2d8924f18f01762c20defa026366a1f00937d.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-DXJEH1ZRXX"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-DXJEH1ZRXX")}</script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/eg-pr-preview/5-test-docs-preview/zh/><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 1200 400"><defs><style>.cls-1{fill:#d04c9b}.cls-2{fill:#4a2365}.cls-3{fill:#b96aab}.cls-4{isolation:isolate}.cls-5{fill:#a53995}</style></defs><g><g id="Layer_1"><g><polygon id="polygon20" class="cls-5" points="191.2 242.29 190.55 213 159.76 193.83 160.4 223.12 191.2 242.29"/><path id="path22" class="cls-5" d="M234.92 315.52l-.65-28.65-26.92-16.8c-.43-.21-.86-.64-1.08-.86l.65 28.86 28 17.45h0z"/><path id="path24" class="cls-5" d="M138.65 354.07l-70.42-43.72-1.73-73.23 34.46-14.86-.65-29.29-55.14 23.69c-4.3 1.94-6.89 5.81-6.67 10.33l2.15 87.87c0 4.53 2.8 9.06 7.11 11.64l84.43 52.33c3.88 2.37 8.61 3.02 12.71 1.94.43-.21.86-.21 1.29-.43l51.9-22.39-28.21-17.45-31.23 13.57h0z"/><path id="path26" class="cls-3" d="M366.29 192.11c-.21-5.17-3.23-10.55-8.39-13.57l-102.52-63.53-3.23 1.29.64 30.8 81.19 50.4 1.94 82.27 31.01 19.17 1.72-.64-2.37-106.18h0z"/><path id="path28" class="cls-3" d="M243.53 336.62l-95.41-59.01-2.37-99.07 43.51-18.74-.86-34.24-67.41 29.07c-4.95 2.16-7.97 6.68-7.75 12.06l2.8 116.3c0 5.38 3.23 10.56 8.4 13.57l111.78 69.35c4.52 2.79 10.12 3.66 14.86 2.15.43-.22.86-.43 1.29-.43l65.9-28.44-32.73-20.25-42 17.67h0z"/><path id="path30" class="cls-1" d="M511.67 110.69 368.45 21.96c-5.38-3.23-11.62-4.1-17-2.37-.44.21-1.08.43-1.51.64L210.16 80.54c-5.6 2.37-9.04 7.54-8.83 13.78l3.44 149.04c.22 6.03 3.88 12.06 9.7 15.51l143.22 88.73c5.17 3.23 11.63 4.09 17.01 2.38.43-.22 1.08-.44 1.51-.65l139.78-60.3c5.59-2.37 9.05-7.75 8.84-13.79l-3.45-149.04c-.21-6.03-3.88-11.85-9.69-15.51M366.08 314.22 241.6 237.11l-3.02-129.44 121.47-52.33 124.49 77.1 3.02 129.45-121.47 52.33h0z"/></g><path id="path10" class="cls-2" d="M607.46 182.14c0 4.62 1.08 9.04 3.23 12.83 2.16 3.78 4.95 7.15 8.18 9.88 3.44 2.74 7.33 4.84 11.84 6.32 4.52 1.47 9.26 2.31 14 2.31 6.46.0 12.27-1.48 17.01-4.41 4.73-2.96 9.26-6.96 13.35-11.79L691 209.07c-11.63 14.71-27.99 22.08-48.88 22.08-8.61.0-16.58-1.47-23.69-4.41-7.11-2.96-13.13-6.95-17.88-12-4.95-5.05-8.61-11.15-11.19-17.88-2.58-6.94-3.88-14.31-3.88-22.51s1.51-15.57 4.31-22.51 6.89-12.83 11.84-17.88 10.98-9.04 18.09-12c6.9-2.94 14.65-4.42 22.83-4.42 9.69.0 18.09 1.69 24.77 5.06 6.67 3.36 12.27 7.77 16.58 13.03 4.31 5.48 7.54 11.37 9.48 18.31 1.94 6.73 3.01 13.67 3.01 20.62v7.37h-88.93v.21h0zM673.78 165.95c-.22-4.63-.86-8.64-2.15-12.42-1.29-3.79-3.23-7.15-6.03-9.89-2.59-2.74-6.02-5.05-9.91-6.53-3.88-1.69-8.61-2.31-13.78-2.31s-9.9 1.05-13.99 2.94c-4.31 1.88-7.97 4.42-10.77 7.36-3.01 2.94-5.17 6.31-6.89 10.1s-2.37 7.37-2.37 10.95h65.89v-.21h0z"/><path id="path12" class="cls-2" d="M714.26 120.71h20.89v16.61h.43c2.58-5.68 7.32-10.52 13.78-13.88 6.46-3.58 14-5.26 22.61-5.26 5.39.0 10.34.84 15.29 2.31 4.95 1.68 9.26 4.01 12.71 7.36 3.66 3.37 6.46 7.57 8.83 12.84 2.16 5.26 3.23 11.36 3.23 18.51v69.44h-20.89v-63.76c0-5.05-.65-9.25-2.15-12.83-1.3-3.58-3.23-6.53-5.6-8.64-2.37-2.1-4.95-3.79-7.97-4.83-3.01-1.06-6.24-1.48-9.47-1.48-4.3.0-8.4.63-12.06 2.1-3.66 1.48-6.89 3.58-9.68 6.53-2.8 2.94-4.96 6.73-6.47 11.35-1.5 4.63-2.37 9.89-2.37 16.21v55.55h-20.88V120.69h-.22v.02z"/><polygon id="polygon14" class="cls-2" points="843.03 120.71 875.98 203.4 907.63 120.71 930.03 120.71 886.74 228.64 863.71 228.64 818.7 120.71 843.03 120.71"/><path id="path16" class="cls-2" d="M931.53 174.77c0-7.78 1.51-15.15 4.53-22.09 3.01-6.73 7.1-12.83 12.49-17.88 5.38-5.06 11.41-9.26 18.73-12.2 7.12-2.95 14.86-4.42 23.04-4.42s15.93 1.47 23.04 4.42c7.1 2.94 13.36 6.93 18.73 12.2 5.17 5.25 9.48 11.15 12.5 17.88 3.01 6.73 4.53 14.1 4.53 22.09s-1.52 15.36-4.53 22.1c-3.02 6.94-7.11 12.83-12.5 17.88-5.37 5.05-11.4 9.04-18.73 12-7.11 2.94-14.85 4.41-23.04 4.41s-15.93-1.47-23.04-4.41c-7.1-2.96-13.35-6.95-18.73-12-5.39-5.05-9.48-11.15-12.49-17.88-3.01-6.94-4.53-14.31-4.53-22.1M953.71 174.77c0 5.47.86 10.52 2.59 15.15 1.71 4.62 4.09 8.62 7.31 11.79 3.02 3.37 6.9 5.89 11.42 7.78 4.52 1.89 9.48 2.94 15.08 2.94s10.55-.84 15.07-2.94c4.51-1.89 8.4-4.41 11.42-7.78 3-3.16 5.59-7.16 7.31-11.79 1.73-4.63 2.59-9.68 2.59-15.15s-.86-10.52-2.59-15.15c-1.71-4.63-4.09-8.63-7.31-11.78-3.02-3.15-6.9-5.89-11.42-7.78-4.52-1.89-9.48-2.94-15.07-2.94s-10.56 1.05-15.08 2.94c-4.52 1.9-8.39 4.42-11.42 7.78-3 3.37-5.59 7.15-7.31 11.78-1.73 4.63-2.59 9.68-2.59 15.15"/><path id="path18" class="cls-2" d="M1050.39 120.71h24.12l32.74 84.15h.42l31.44-84.15h22.4l-52.32 131.07c-1.94 4.63-3.88 9.05-5.82 12.84s-4.31 7.15-7.11 9.88c-2.79 2.73-6.25 4.84-10.12 6.31-3.88 1.48-8.82 2.31-14.43 2.31-3.02.0-6.24-.21-9.48-.62-3.22-.41-6.25-1.26-9.25-2.31l2.58-18.74c4.09 1.69 8.4 2.53 12.49 2.53 3.24.0 6.03-.42 8.18-1.26 2.16-.84 4.09-2.1 5.81-3.58 1.73-1.69 3.03-3.36 4.09-5.46 1.08-2.12 2.15-4.63 3.23-7.37l6.88-17.04-45.86-108.56h0z"/><g class="cls-4"><path class="cls-5" d="M636.86 328.23c0 8.4-2.15 14.77-6.44 19.14-4.3 4.36-10.51 6.54-18.65 6.54-4.53.0-8.61-.66-12.25-1.97s-7.1-3.58-10.38-6.79l5.51-6.3c2.43 2.62 5 4.61 7.72 5.95s5.85 2.02 9.4 2.02 6.25-.51 8.51-1.52c2.26-1.02 4.05-2.4 5.36-4.13 1.31-1.74 2.23-3.72 2.75-5.95.52-2.23.79-4.56.79-6.99v-5.9h-.2c-1.84 2.95-4.23 5.12-7.18 6.49-2.95 1.38-5.97 2.07-9.05 2.07-3.61.0-6.92-.59-9.94-1.77-3.02-1.18-5.61-2.82-7.77-4.92s-3.84-4.59-5.02-7.48c-1.18-2.89-1.77-6.03-1.77-9.45.0-3.74.59-7.12 1.77-10.13 1.18-3.02 2.84-5.56 4.97-7.62 2.13-2.07 4.71-3.66 7.72-4.77 3.02-1.11 6.36-1.67 10.04-1.67 1.57.0 3.15.18 4.72.54s3.1.92 4.58 1.67 2.8 1.71 3.98 2.85c1.18 1.15 2.17 2.48 2.95 3.98h.2v-7.87h7.67v43.98zm-40.34-20.95c0 2.36.43 4.54 1.28 6.54s2.02 3.74 3.49 5.21c1.48 1.48 3.2 2.64 5.17 3.49 1.97.85 4.07 1.28 6.3 1.28 2.62.0 4.95-.46 6.99-1.38 2.03-.92 3.75-2.15 5.17-3.69 1.41-1.54 2.48-3.31 3.2-5.31s1.08-4.12 1.08-6.35c0-2.49-.39-4.77-1.18-6.84s-1.9-3.85-3.34-5.36-3.18-2.67-5.21-3.49c-2.03-.82-4.26-1.23-6.69-1.23s-4.64.44-6.64 1.33c-2 .88-3.71 2.1-5.12 3.64-1.41 1.54-2.51 3.35-3.3 5.41-.79 2.07-1.18 4.31-1.18 6.74z"/><path class="cls-5" d="M650.44 290.16c2.36-2.43 5.17-4.21 8.41-5.36 3.25-1.15 6.54-1.72 9.89-1.72 6.82.0 11.74 1.61 14.76 4.82s4.53 8.1 4.53 14.66v19.78c0 1.31.06 2.67.2 4.08.13 1.41.3 2.71.49 3.89h-7.38c-.26-1.05-.41-2.21-.44-3.49-.03-1.28-.05-2.41-.05-3.39h-.2c-1.51 2.36-3.53 4.3-6.05 5.81-2.53 1.51-5.56 2.26-9.1 2.26-2.36.0-4.58-.29-6.64-.89-2.07-.59-3.87-1.46-5.41-2.61-1.54-1.15-2.77-2.57-3.69-4.28-.92-1.71-1.38-3.67-1.38-5.9.0-3.8.98-6.79 2.95-8.95 1.97-2.16 4.41-3.77 7.33-4.82 2.92-1.05 6.07-1.7 9.45-1.97 3.38-.26 6.48-.39 9.3-.39h2.95v-1.38c0-3.35-1-5.87-3-7.58s-4.81-2.56-8.41-2.56c-2.49.0-4.94.41-7.33 1.23-2.4.82-4.51 2.08-6.35 3.79l-4.82-5.02zM672.67 308.16c-4.92.0-8.82.69-11.71 2.07s-4.33 3.64-4.33 6.79c0 2.89.97 4.94 2.9 6.15s4.34 1.82 7.23 1.82c2.23.0 4.18-.38 5.85-1.13 1.67-.75 3.07-1.75 4.18-3 1.12-1.25 1.97-2.71 2.56-4.38.59-1.67.92-3.46.98-5.36v-2.95h-7.67z"/><path class="cls-5" d="M727.28 290.75H713.7v23.02c0 1.51.03 2.9.1 4.18.06 1.28.33 2.39.79 3.34.46.95 1.15 1.71 2.07 2.26.92.56 2.23.84 3.94.84 1.11.0 2.26-.13 3.44-.39 1.18-.26 2.3-.66 3.35-1.18l.29 6.99c-1.31.59-2.77 1.02-4.38 1.28s-3.13.39-4.58.39c-2.75.0-4.95-.36-6.59-1.08-1.64-.72-2.92-1.74-3.84-3.05-.92-1.31-1.52-2.93-1.82-4.87-.29-1.93-.44-4.08-.44-6.44v-25.29h-10.04v-6.49h10.04v-13.09h7.67v13.09h13.58v6.49z"/><path class="cls-5" d="M777.85 321.94c-2.75 3.54-5.77 6.02-9.05 7.43s-7.08 2.12-11.41 2.12c-3.61.0-6.85-.64-9.74-1.92-2.89-1.28-5.33-3-7.33-5.17s-3.54-4.72-4.62-7.67-1.62-6.1-1.62-9.45c0-3.54.59-6.8 1.77-9.79 1.18-2.98 2.82-5.54 4.92-7.67 2.1-2.13 4.59-3.79 7.48-4.97s6.03-1.77 9.45-1.77c3.21.0 6.17.54 8.86 1.62s5 2.66 6.94 4.72c1.93 2.07 3.43 4.59 4.48 7.58 1.05 2.99 1.57 6.38 1.57 10.18v2.46h-37.19c.13 1.97.61 3.85 1.43 5.66.82 1.81 1.88 3.38 3.2 4.72 1.31 1.35 2.85 2.41 4.62 3.2 1.77.79 3.71 1.18 5.8 1.18 3.35.0 6.17-.59 8.46-1.77 2.29-1.18 4.36-2.92 6.2-5.21l5.8 4.53zM771.26 303.14c-.13-3.94-1.41-7.08-3.84-9.45-2.43-2.36-5.77-3.54-10.04-3.54s-7.71 1.18-10.33 3.54-4.2 5.51-4.72 9.45h28.93z"/><path class="cls-5" d="M840.82 330.3h-7.58l-13.09-35.42h-.2l-11.61 35.42h-7.87l-14.96-46.05h8.46l10.53 35.42h.2l11.91-35.42h8.07l12.1 35.42h.2l10.43-35.42h8.26l-14.86 46.05z"/><path class="cls-5" d="M863.74 290.16c2.36-2.43 5.17-4.21 8.41-5.36 3.25-1.15 6.54-1.72 9.89-1.72 6.82.0 11.74 1.61 14.76 4.82s4.53 8.1 4.53 14.66v19.78c0 1.31.06 2.67.2 4.08.13 1.41.29 2.71.49 3.89h-7.38c-.26-1.05-.41-2.21-.44-3.49-.04-1.28-.05-2.41-.05-3.39h-.2c-1.51 2.36-3.53 4.3-6.05 5.81-2.53 1.51-5.56 2.26-9.1 2.26-2.36.0-4.58-.29-6.64-.89-2.07-.59-3.87-1.46-5.41-2.61-1.54-1.15-2.77-2.57-3.69-4.28-.92-1.71-1.38-3.67-1.38-5.9.0-3.8.98-6.79 2.95-8.95 1.97-2.16 4.41-3.77 7.33-4.82 2.92-1.05 6.07-1.7 9.45-1.97 3.38-.26 6.48-.39 9.3-.39h2.95v-1.38c0-3.35-1-5.87-3-7.58s-4.8-2.56-8.41-2.56c-2.49.0-4.94.41-7.33 1.23-2.4.82-4.51 2.08-6.35 3.79l-4.82-5.02zm22.24 18c-4.92.0-8.82.69-11.71 2.07s-4.33 3.64-4.33 6.79c0 2.89.97 4.94 2.9 6.15s4.34 1.82 7.23 1.82c2.23.0 4.18-.38 5.85-1.13 1.67-.75 3.07-1.75 4.18-3 1.12-1.25 1.97-2.71 2.56-4.38.59-1.67.92-3.46.98-5.36v-2.95h-7.68z"/><path class="cls-5" d="M932.32 340.83c-.79 1.97-1.59 3.75-2.41 5.36-.82 1.61-1.8 2.98-2.95 4.13-1.15 1.15-2.53 2.03-4.13 2.66-1.61.62-3.56.93-5.85.93-1.12.0-2.28-.07-3.49-.2s-2.35-.46-3.39-.98l.98-6.69c.79.33 1.61.54 2.46.64.85.1 1.84.15 2.95.15 2.49.0 4.33-.69 5.51-2.07s2.2-3.21 3.05-5.51l3.15-8.66-19.09-46.34h8.95l14.27 36.11h.2l13.68-36.11h8.36l-22.24 56.57z"/></g></g></g></svg></span><span class=navbar-brand__name>Envoy Gateway</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/zh/eg-pr-preview/5-test-docs-preview/latest><span>文档</span></a></li><li class=nav-item><a class=nav-link href=/zh/eg-pr-preview/5-test-docs-preview/news><span>新闻</span></a></li><li class=nav-item><a class=nav-link href=/zh/eg-pr-preview/5-test-docs-preview/about><span>关于</span></a></li><li class=nav-item><a class=nav-link href=/zh/eg-pr-preview/5-test-docs-preview/contributions><span>贡献</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Versions</a><ul class=dropdown-menu><li><a class=dropdown-item href=https://zirain.github.io/eg-pr-preview/5-test-docs-preview//latest>latest</a></li><li><a class=dropdown-item href=https://zirain.github.io/eg-pr-preview/5-test-docs-preview//docs>v1.2</a></li><li><a class=dropdown-item href=https://zirain.github.io/eg-pr-preview/5-test-docs-preview//v1.1>v1.1</a></li><li><a class=dropdown-item href=https://zirain.github.io/eg-pr-preview/5-test-docs-preview//v1.0>v1.0</a></li><li><a class=dropdown-item href=https://zirain.github.io/eg-pr-preview/5-test-docs-preview//v0.6>v0.6</a></li><li><a class=dropdown-item href=https://zirain.github.io/eg-pr-preview/5-test-docs-preview//v0.5>v0.5</a></li><li><a class=dropdown-item href=https://zirain.github.io/eg-pr-preview/5-test-docs-preview//v0.4>v0.4</a></li><li><a class=dropdown-item href=https://zirain.github.io/eg-pr-preview/5-test-docs-preview//v0.3>v0.3</a></li><li><a class=dropdown-item href=https://zirain.github.io/eg-pr-preview/5-test-docs-preview//v0.2>v0.2</a></li></ul></div></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>中文</a><ul class=dropdown-menu><li><a class=dropdown-item href=/eg-pr-preview/5-test-docs-preview/latest/tasks/>English</a></li></ul></div></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/eg-pr-preview/5-test-docs-preview/offline-search-index.59545f0114544c87ac67cca9eb52ae6d.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/eg-pr-preview/5-test-docs-preview/zh/latest/tasks/>Return to the regular view of this page</a>.</p></div><h1 class=title>任务</h1><div class=lead>通过任务学习 Envoy Gateway 实践。</div><ul><li>1: <a href=#pg-8a4261da47f1b52b2b25a09c435e33a0>快速入门</a></li><li>2: <a href=#pg-676b456ea0b1a3c24f3c1b492ab3f792>GRPC 路由</a></li><li>3: <a href=#pg-d6b22b6dd91dcd158e113fdcb4f765b2>JWT 身份验证</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-8a4261da47f1b52b2b25a09c435e33a0>1 - 快速入门</h1><div class=lead>只需几个简单的步骤即可开始使用 Envoy Gateway。</div><p>本指南将帮助您通过几个简单的步骤开始使用 Envoy Gateway。</p><h2 id=prerequisites>前置条件<a class=td-heading-self-link href=#prerequisites aria-label="Heading self-link"></a></h2><p>一个 Kubernetes 集群。</p><p><strong>注意：</strong> 请参考<a href=/eg-pr-preview/5-test-docs-preview/zh/latest/install/matrix/>兼容性表格</a>来查看所支持的 Kubernetes 版本。</p><p><strong>注意：</strong> 如果您的 Kubernetes 集群没有负载均衡器实现，我们建议安装一个
，以便 Gateway 资源能够关联一个地址。我们推荐使用 <a href=https://metallb.universe.tf/installation/>MetalLB</a>。</p><h2 id=installation>安装<a class=td-heading-self-link href=#installation aria-label="Heading self-link"></a></h2><p>安装 Gateway API CRD 和 Envoy Gateway：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>helm install eg oci://docker.io/envoyproxy/gateway-helm --version v0.0.0-latest -n envoy-gateway-system --create-namespace
</span></span></code></pre></div><p>等待 Envoy Gateway 至可用后：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl <span style=color:#204a87>wait</span> --timeout<span style=color:#ce5c00;font-weight:700>=</span>5m -n envoy-gateway-system deployment/envoy-gateway --for<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>condition</span><span style=color:#ce5c00;font-weight:700>=</span>Available
</span></span></code></pre></div><p>安装 GatewayClass，Gateway，HTTPRoute 和示例应用：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://github.com/envoyproxy/gateway/releases/download/latest/quickstart.yaml -n default
</span></span></code></pre></div><p><strong>注意：</strong><a href=https://github.com/envoyproxy/gateway/releases/download/latest/quickstart.yaml><code>quickstart.yaml</code></a> 定义了 Envoy Gateway 将侦听其全局可路由 IP 地址上端口
80 上的流量，以便轻松使用浏览器测试 Envoy Gateway。当 Envoy Gateway 看到它的侦听器使用特权端口（&lt;1024），
它将在内部映射到非特权端口，因此 Envoy Gateway 不需要额外的特权。
了解此映射很重要，当您调试时您可能需要将其考虑在内。</p><h2 id=testing-the-configuration>测试配置<a class=td-heading-self-link href=#testing-the-configuration aria-label="Heading self-link"></a></h2><ul class="nav nav-tabs" id=tabs-0 role=tablist><li class=nav-item><button class="nav-link active" id=tabs-00-00-tab data-bs-toggle=tab data-bs-target=#tabs-00-00 role=tab data-td-tp-persist=不使用负载均衡器 aria-controls=tabs-00-00 aria-selected=true>
不使用负载均衡器</button></li><li class=nav-item><button class=nav-link id=tabs-00-01-tab data-bs-toggle=tab data-bs-target=#tabs-00-01 role=tab data-td-tp-persist=使用外部负载均衡器 aria-controls=tabs-00-01 aria-selected=false>
使用外部负载均衡器</button></li></ul><div class=tab-content id=tabs-0-content><div class="tab-body tab-pane fade show active" id=tabs-00-00 role=tabpanel aria-labelled-by=tabs-00-00-tab tabindex=0><p>获取由示例 Gateway 创建的 Envoy 服务的名称：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>ENVOY_SERVICE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>kubectl get svc -n envoy-gateway-system --selector<span style=color:#ce5c00;font-weight:700>=</span>gateway.envoyproxy.io/owning-gateway-namespace<span style=color:#ce5c00;font-weight:700>=</span>default,gateway.envoyproxy.io/owning-gateway-name<span style=color:#ce5c00;font-weight:700>=</span>eg -o <span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{.items[0].metadata.name}&#39;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span></code></pre></div><p>端口转发到 Envoy 服务：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl -n envoy-gateway-system port-forward service/<span style=color:#4e9a06>${</span><span style=color:#000>ENVOY_SERVICE</span><span style=color:#4e9a06>}</span> 8888:80 <span style=color:#000;font-weight:700>&amp;</span>
</span></span></code></pre></div><p>通过 Envoy 代理，使用 curl 测试示例应用：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl --verbose --header <span style=color:#4e9a06>&#34;Host: www.example.com&#34;</span> http://localhost:8888/get
</span></span></code></pre></div></div><div class="tab-body tab-pane fade" id=tabs-00-01 role=tabpanel aria-labelled-by=tabs-00-01-tab tabindex=0><p>您还可以通过将流量发送到外部 IP 来测试相同的功能。运行下面的命令可以获取 Envoy 服务的外部 IP 地址：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>GATEWAY_HOST</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>kubectl get svc/<span style=color:#4e9a06>${</span><span style=color:#000>ENVOY_SERVICE</span><span style=color:#4e9a06>}</span> -n envoy-gateway-system -o <span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{.status.loadBalancer.ingress[0].ip}&#39;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span></code></pre></div><p>在某些环境中，负载均衡器可能会公开主机名而不是 IP 地址，如果是这样，将上述命令中的 <code>ip</code> 替换为 <code>hostname</code> 。</p><p>使用 curl 来通过 Envoy Proxy 访问示例应用：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl --verbose --header <span style=color:#4e9a06>&#34;Host: www.example.com&#34;</span> http://<span style=color:#000>$GATEWAY_HOST</span>/get
</span></span></code></pre></div></div></div><h2 id=what-to-explore-next>接下来的探索？<a class=td-heading-self-link href=#what-to-explore-next aria-label="Heading self-link"></a></h2><p>在快速开始（本节），您将：</p><ul><li>完成 Envoy Gateway 的安装</li><li>部署一个后端服务和一个网关</li><li>使用 Kubernetes Gateway API 资源 <a href=https://gateway-api.sigs.k8s.io/api-types/gateway/>Gateway</a> 和 <a href=https://gateway-api.sigs.k8s.io/api-types/httproute/>HttpRoute</a> 配置网关。将网关传入的 HTTP 请求转发到后端服务。</li></ul><p>以下是建议的后续任务列表，可指导您探索 Envoy Gateway：</p><ul><li><a href=https://gateway.envoyproxy.io/latest/tasks/traffic/http-routing/>HTTP 路由</a></li><li><a href=https://gateway.envoyproxy.io/latest/tasks/traffic/http-traffic-splitting/>流量拆分</a></li><li><a href=https://gateway.envoyproxy.io/latest/tasks/security/secure-gateways/>安全网关</a></li><li><a href=https://gateway.envoyproxy.io/latest/tasks/traffic/global-rate-limit/>全局限流</a></li><li><a href=https://gateway.envoyproxy.io/latest/tasks/traffic/grpc-routing/>gRPC 路由</a></li></ul><p>请查看与您使用情况相符的场景下的<a href=/eg-pr-preview/5-test-docs-preview/zh/>任务</a>部分。Envoy Gateway 的任务按照流量管理、安全、扩展性、可观察性和运维等分类组织。</p><h2 id=clean-up>清理<a class=td-heading-self-link href=#clean-up aria-label="Heading self-link"></a></h2><p>请按照本节中的步骤将快速入门中的所有内容卸载。</p><p>删除 GatewayClass，Gateway，HTTPRoute 和示例应用：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete -f https://github.com/envoyproxy/gateway/releases/download/latest/quickstart.yaml --ignore-not-found<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>
</span></span></code></pre></div><p>删除 Gateway API CRD 和 Envoy Gateway：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>helm uninstall eg -n envoy-gateway-system
</span></span></code></pre></div><h2 id=next-steps>接下来<a class=td-heading-self-link href=#next-steps aria-label="Heading self-link"></a></h2><p>浏览<a href=/eg-pr-preview/5-test-docs-preview/zh/contributions/develop/>开发者指南</a> ，了解如何参与项目。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-676b456ea0b1a3c24f3c1b492ab3f792>2 - GRPC 路由</h1><p><a href=https://gateway-api.sigs.k8s.io/api-types/grpcroute/>GRPCRoute</a> 资源允许用户通过匹配 HTTP/2 流量并将其转发到后端 gRPC 服务器来配置 gRPC 路由。
要了解有关 gRPC 路由的更多信息，请参阅<a href=https://gateway-api.sigs.k8s.io/>Gateway API 文档</a>。</p><h2 id=prerequisites>先决条件<a class=td-heading-self-link href=#prerequisites aria-label="Heading self-link"></a></h2><p>按照<a href=/eg-pr-preview/5-test-docs-preview/zh/latest/tasks/quickstart/>快速入门</a>中的步骤安装 Envoy Gateway 和示例清单。
在继续之前，您应该能够使用 HTTP 查询示例程序后端。</p><h2 id=installation>安装<a class=td-heading-self-link href=#installation aria-label="Heading self-link"></a></h2><p>安装 gRPC 路由示例资源：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://raw.githubusercontent.com/envoyproxy/gateway/latest/examples/kubernetes/grpc-routing.yaml
</span></span></code></pre></div><p>该清单安装 <a href=https://gateway-api.sigs.k8s.io/api-types/gatewayclass/>GatewayClass</a>、<a href=https://gateway-api.sigs.k8s.io/api-types/gateway/>Gateway</a>、Deployment、Service 和 GRPCRoute 资源。
GatewayClass 是集群范围的资源，表示可以被实例化的一类 Gateway。</p><p>**注意：**Envoy Gateway 默认被配置为使用 <code>controllerName: gateway.envoyproxy.io/gatewayclass-controller</code> 管理 GatewayClass。</p><h2 id=verification>验证<a class=td-heading-self-link href=#verification aria-label="Heading self-link"></a></h2><p>检查 GatewayClass 的状态：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get gc --selector<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>example</span><span style=color:#ce5c00;font-weight:700>=</span>grpc-routing
</span></span></code></pre></div><p>状态应反映为 <code>Accepted=True</code>，表示 Envoy Gateway 正在管理 GatewayClass。</p><p>Gateway 代表基础设施的配置。创建 Gateway 时，<a href=https://www.envoyproxy.io/>Envoy 代理</a>基础设施由 Envoy Gateway 预配或配置。
<code>gatewayClassName</code> 定义此 Gateway 使用的 GatewayClass 的名称。检查 Gateway 状态：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get gateways --selector<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>example</span><span style=color:#ce5c00;font-weight:700>=</span>grpc-routing
</span></span></code></pre></div><p>状态应反映为 <code>Ready=True</code>，表示 Envoy 代理基础设施已被配置。
该状态还提供 Gateway 的地址。该地址稍后用于测试与代理后端服务的连接。</p><p>检查 GRPCRoute 的状态：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get grpcroutes --selector<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>example</span><span style=color:#ce5c00;font-weight:700>=</span>grpc-routing -o yaml
</span></span></code></pre></div><p>GRPCRoute 的状态应显示 <code>Accepted=True</code> 和引用示例 Gateway 的 <code>parentRef</code>。
<code>example-route</code> 匹配 <code>grpc-example.com</code> 的任何流量并将其转发到 <code>yages</code> 服务。</p><h2 id=testing-the-configuration>测试配置<a class=td-heading-self-link href=#testing-the-configuration aria-label="Heading self-link"></a></h2><p>在测试到 <code>yages</code> 后端的 GRPC 路由之前，请获取 Gateway 的地址。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>GATEWAY_HOST</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>kubectl get gateway/example-gateway -o <span style=color:#000>jsonpath</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{.status.addresses[0].value}&#39;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span></code></pre></div><p>使用 <a href=https://github.com/fullstorydev/grpcurl>grpcurl</a> 命令测试到 <code>yages</code> 后端的 GRPC 路由。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>grpcurl -plaintext -authority<span style=color:#ce5c00;font-weight:700>=</span>grpc-example.com <span style=color:#4e9a06>${</span><span style=color:#000>GATEWAY_HOST</span><span style=color:#4e9a06>}</span>:80 yages.Echo/Ping
</span></span></code></pre></div><p>您应该看到以下响应：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;text&#34;</span>: <span style=color:#4e9a06>&#34;pong&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>Envoy Gateway 还支持此配置的 <a href=https://github.com/grpc/grpc/blob/master/doc/PROTOCOL-WEB.md#protocol-differences-vs-grpc-over-http2>gRPC-Web</a> 请求。下面的 <code>curl</code> 命令可用于通过 HTTP/2 发送 grpc-Web 请求。
您应该收到与上一个命令相同的响应。</p><p>正文 <code>AAAAAAA=</code> 中的数据是 Ping RPC 接受的空消息（数据长度为 0）的 Base64 编码表示。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl --http2-prior-knowledge -s <span style=color:#4e9a06>${</span><span style=color:#000>GATEWAY_HOST</span><span style=color:#4e9a06>}</span>:80/yages.Echo/Ping -H <span style=color:#4e9a06>&#39;Host: grpc-example.com&#39;</span>   -H <span style=color:#4e9a06>&#39;Content-Type: application/grpc-web-text&#39;</span>   -H <span style=color:#4e9a06>&#39;Accept: application/grpc-web-text&#39;</span> -XPOST -d<span style=color:#4e9a06>&#39;AAAAAAA=&#39;</span> <span style=color:#000;font-weight:700>|</span> base64 -d
</span></span></code></pre></div><h2 id=grpcroute-match>GRPCRoute 匹配<a class=td-heading-self-link href=#grpcroute-match aria-label="Heading self-link"></a></h2><p><code>matches</code> 字段可用于根据 GRPC 的服务和/或方法名称将路由限制到一组特定的请求。
它支持两种匹配类型：<code>Exact</code>（精准）和 <code>RegularExpression</code>（正则）。</p><h3 id=exact>精准<a class=td-heading-self-link href=#exact aria-label="Heading self-link"></a></h3><p><code>Exact</code>（精准）匹配是默认匹配类型。</p><p>以下示例显示如何根据 <code>grpc.reflection.v1alpha.ServerReflection/ServerReflectionInfo</code> 的服务和方法名称来匹配请求，
以及如何在我们的部署中匹配方法名称为 <code>Ping</code> 且与 <code>yages.Echo/Ping</code> 匹配的所有服务。</p><ul class="nav nav-tabs" id=tabs-0 role=tablist><li class=nav-item><button class="nav-link active" id=tabs-00-00-tab data-bs-toggle=tab data-bs-target=#tabs-00-00 role=tab data-td-tp-persist=通过标准输入应用 aria-controls=tabs-00-00 aria-selected=true>
通过标准输入应用</button></li><li class=nav-item><button class=nav-link id=tabs-00-01-tab data-bs-toggle=tab data-bs-target=#tabs-00-01 role=tab data-td-tp-persist=通过文件应用 aria-controls=tabs-00-01 aria-selected=false>
通过文件应用</button></li></ul><div class=tab-content id=tabs-0-content><div class="tab-body tab-pane fade show active" id=tabs-00-00 role=tabpanel aria-labelled-by=tabs-00-00-tab tabindex=0><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: gateway.networking.k8s.io/v1alpha2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: GRPCRoute
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: yages
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  labels:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    example: grpc-routing
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  parentRefs:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - name: example-gateway
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  hostnames:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - &#34;grpc-example.com&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  rules:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - matches:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      - method:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          method: ServerReflectionInfo
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          service: grpc.reflection.v1alpha.ServerReflection
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      - method:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          method: Ping
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      backendRefs:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        - group: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          kind: Service
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          name: yages
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          port: 9000
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          weight: 1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div></div><div class="tab-body tab-pane fade" id=tabs-00-01 role=tabpanel aria-labelled-by=tabs-00-01-tab tabindex=0><p>保存以下资源并将其应用到您的集群：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>---</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>gateway.networking.k8s.io/v1alpha2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>GRPCRoute</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>yages</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>example</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>grpc-routing</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>parentRefs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-gateway</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>hostnames</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#4e9a06>&#34;grpc-example.com&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>matches</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>method</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>method</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServerReflectionInfo</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>service</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>grpc.reflection.v1alpha.ServerReflection</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>method</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>method</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Ping</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>backendRefs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Service</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>yages</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>9000</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></div></div><p>验证 GRPCRoute 状态：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get grpcroutes --selector<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>example</span><span style=color:#ce5c00;font-weight:700>=</span>grpc-routing -o yaml
</span></span></code></pre></div><p>使用 <a href=https://github.com/fullstorydev/grpcurl>grpcurl</a> 命令测试到 <code>yages</code> 后端的 GRPC 路由。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>grpcurl -plaintext -authority<span style=color:#ce5c00;font-weight:700>=</span>grpc-example.com <span style=color:#4e9a06>${</span><span style=color:#000>GATEWAY_HOST</span><span style=color:#4e9a06>}</span>:80 yages.Echo/Ping
</span></span></code></pre></div><h3 id=regularexpression>正则<a class=td-heading-self-link href=#regularexpression aria-label="Heading self-link"></a></h3><p>以下示例演示如何根据服务和方法名称将请求与匹配类型 <code>RegularExpression</code> 进行匹配。
它与模式 <code>/.*.Echo/Pin.+</code> 匹配所有服务和方法，该模式与我们部署中的 <code>yages.Echo/Ping</code> 匹配。</p><ul class="nav nav-tabs" id=tabs-1 role=tablist><li class=nav-item><button class="nav-link active" id=tabs-01-00-tab data-bs-toggle=tab data-bs-target=#tabs-01-00 role=tab data-td-tp-persist=通过标准输入应用 aria-controls=tabs-01-00 aria-selected=true>
通过标准输入应用</button></li><li class=nav-item><button class=nav-link id=tabs-01-01-tab data-bs-toggle=tab data-bs-target=#tabs-01-01 role=tab data-td-tp-persist=通过文件应用 aria-controls=tabs-01-01 aria-selected=false>
通过文件应用</button></li></ul><div class=tab-content id=tabs-1-content><div class="tab-body tab-pane fade show active" id=tabs-01-00 role=tabpanel aria-labelled-by=tabs-01-00-tab tabindex=1><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: gateway.networking.k8s.io/v1alpha2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: GRPCRoute
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: yages
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  labels:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    example: grpc-routing
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  parentRefs:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - name: example-gateway
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  hostnames:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - &#34;grpc-example.com&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  rules:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - matches:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      - method:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          method: ServerReflectionInfo
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          service: grpc.reflection.v1alpha.ServerReflection
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      - method:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          method: &#34;Pin.+&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          service: &#34;.*.Echo&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          type: RegularExpression
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      backendRefs:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        - group: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          kind: Service
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          name: yages
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          port: 9000
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          weight: 1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div></div><div class="tab-body tab-pane fade" id=tabs-01-01 role=tabpanel aria-labelled-by=tabs-01-01-tab tabindex=1><p>保存以下资源并将其应用到您的集群：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>---</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>gateway.networking.k8s.io/v1alpha2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>GRPCRoute</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>yages</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>example</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>grpc-routing</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>parentRefs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-gateway</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>hostnames</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#4e9a06>&#34;grpc-example.com&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>matches</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>method</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>method</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ServerReflectionInfo</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>service</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>grpc.reflection.v1alpha.ServerReflection</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>method</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>method</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;Pin.+&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>service</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;.*.Echo&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>RegularExpression</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>backendRefs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Service</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>yages</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>9000</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></div></div><p>检查 GRPCRoute 状态：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get grpcroutes --selector<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>example</span><span style=color:#ce5c00;font-weight:700>=</span>grpc-routing -o yaml
</span></span></code></pre></div><p>使用 <a href=https://github.com/fullstorydev/grpcurl>grpcurl</a> 命令测试到 <code>yages</code> 后端的 GRPC 路由。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>grpcurl -plaintext -authority<span style=color:#ce5c00;font-weight:700>=</span>grpc-example.com <span style=color:#4e9a06>${</span><span style=color:#000>GATEWAY_HOST</span><span style=color:#4e9a06>}</span>:80 yages.Echo/Ping
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-d6b22b6dd91dcd158e113fdcb4f765b2>3 - JWT 身份验证</h1><p>此任务提供有关配置 <a href=https://tools.ietf.org/html/rfc7519>JSON Web Token（JWT）</a>身份验证的说明。
JWT 身份验证在将请求路由到后端服务之前检查传入请求是否具有有效的 JWT。
目前，Envoy Gateway 仅支持通过 HTTP 标头验证 JWT，例如 <code>Authorization: Bearer &lt;token></code>。</p><p>Envoy Gateway 引入了一个名为 <a href=/eg-pr-preview/5-test-docs-preview/zh/contributions/design/security-policy/>SecurityPolicy</a> 的新 CRD，允许用户配置 JWT 身份验证。
该实例化资源可以链接到 <a href=https://gateway-api.sigs.k8s.io/api-types/gateway>Gateway</a>、<a href=https://gateway-api.sigs.k8s.io/api-types/httproute>HTTPRoute</a> 或 <a href=https://gateway-api.sigs.k8s.io/api-types/grpcroute>GRPCRoute</a> 资源。</p><h2 id=prerequisites>先决条件<a class=td-heading-self-link href=#prerequisites aria-label="Heading self-link"></a></h2><p>按照<a href=/eg-pr-preview/5-test-docs-preview/zh/latest/tasks/quickstart/>快速入门</a>中的步骤安装 Envoy Gateway 和示例清单。
对于 GRPC - 请按照 <a href=/eg-pr-preview/5-test-docs-preview/zh/latest/tasks/traffic/grpc-routing/>GRPC 路由</a>示例中的步骤操作。
在继续之前，您应该能够使用 HTTP 或 GRPC 查询示例程序后端。</p><h2 id=configuration>配置<a class=td-heading-self-link href=#configuration aria-label="Heading self-link"></a></h2><p>通过创建 <a href=/eg-pr-preview/5-test-docs-preview/zh/contributions/design/security-policy/>SecurityPolicy</a> 并将其附加到示例 HTTPRoute 或 GRPCRoute，允许使用具有有效 JWT 的请求。</p><h3 id=httproute>HTTPRoute<a class=td-heading-self-link href=#httproute aria-label="Heading self-link"></a></h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://raw.githubusercontent.com/envoyproxy/gateway/latest/examples/kubernetes/jwt/jwt.yaml
</span></span></code></pre></div><p>已创建两个 HTTPRoute，一个用于 <code>/foo</code>，另一个用于 <code>/bar</code>。
已创建 SecurityPolicy 并以 HTTPRoute foo 为目标来验证对 <code>/foo</code> 的请求。
HTTPRoute bar 不是 SecurityPolicy 的目标，并且将允许未经身份验证的请求发送到 <code>/bar</code>。</p><p>验证 HTTPRoute 配置和状态：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get httproute/foo -o yaml
</span></span><span style=display:flex><span>kubectl get httproute/bar -o yaml
</span></span></code></pre></div><p>SecurityPolicy 配置为 JWT 身份验证，并使用单个 <a href=https://tools.ietf.org/html/rfc7517>JSON Web Key Set（JWKS）</a>提供程序来对 JWT 进行身份验证。</p><p>验证 SecurityPolicy 配置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get securitypolicy/jwt-example -o yaml
</span></span></code></pre></div><h3 id=grpcroute>GRPCRoute<a class=td-heading-self-link href=#grpcroute aria-label="Heading self-link"></a></h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f https://raw.githubusercontent.com/envoyproxy/gateway/latest/examples/kubernetes/jwt/grpc-jwt.yaml
</span></span></code></pre></div><p>已创建 SecurityPolicy 并针对 GRPCRoute yages 来验证 <code>yages</code> 服务的所有请求。</p><p>验证 GRPCRoute 配置和状态：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get grpcroute/yages -o yaml
</span></span></code></pre></div><p>SecurityPolicy 配置为 JWT 身份验证，并使用单个 <a href=https://tools.ietf.org/html/rfc7517>JSON Web Key Set（JWKS）</a>提供程序来对 JWT 进行身份验证。</p><p>验证 SecurityPolicy 配置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get securitypolicy/jwt-example -o yaml
</span></span></code></pre></div><h2 id=testing>测试<a class=td-heading-self-link href=#testing aria-label="Heading self-link"></a></h2><p>确保设置了<a href=../../quickstart>快速入门</a> 中的 <code>GATEWAY_HOST</code> 环境变量。如果没有，请按照快速入门说明设置变量。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#000>$GATEWAY_HOST</span>
</span></span></code></pre></div><h3 id=httproute-1>HTTPRoute<a class=td-heading-self-link href=#httproute-1 aria-label="Heading self-link"></a></h3><p>验证在没有 JWT 的情况下对 <code>/foo</code> 的请求是否被拒绝：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -sS -o /dev/null -H <span style=color:#4e9a06>&#34;Host: www.example.com&#34;</span> -w <span style=color:#4e9a06>&#34;%{http_code}\n&#34;</span> http://<span style=color:#000>$GATEWAY_HOST</span>/foo
</span></span></code></pre></div><p>应返回一个 <code>401</code> HTTP 响应码。</p><p>获取用于测试请求身份验证的 JWT：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#000>TOKEN</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>curl https://raw.githubusercontent.com/envoyproxy/gateway/main/examples/kubernetes/jwt/test.jwt -s<span style=color:#204a87;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;</span><span style=color:#000>$TOKEN</span><span style=color:#4e9a06>&#34;</span> <span style=color:#000;font-weight:700>|</span> cut -d <span style=color:#4e9a06>&#39;.&#39;</span> -f2 - <span style=color:#000;font-weight:700>|</span> base64 --decode
</span></span></code></pre></div><p>**注意：**上述命令解码并返回令牌的有效内容。您可以将 <code>f2</code> 替换为 <code>f1</code> 来查看令牌的标头。</p><p>验证是否允许使用有效 JWT 向 <code>/foo</code> 发出请求：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -sS -o /dev/null -H <span style=color:#4e9a06>&#34;Host: www.example.com&#34;</span> -H <span style=color:#4e9a06>&#34;Authorization: Bearer </span><span style=color:#000>$TOKEN</span><span style=color:#4e9a06>&#34;</span> -w <span style=color:#4e9a06>&#34;%{http_code}\n&#34;</span> http://<span style=color:#000>$GATEWAY_HOST</span>/foo
</span></span></code></pre></div><p>应返回一个 <code>200</code> HTTP 响应码。</p><p>验证是否允许在<strong>没有</strong> JWT 的情况下向 <code>/bar</code> 发出请求：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -sS -o /dev/null -H <span style=color:#4e9a06>&#34;Host: www.example.com&#34;</span> -w <span style=color:#4e9a06>&#34;%{http_code}\n&#34;</span> http://<span style=color:#000>$GATEWAY_HOST</span>/bar
</span></span></code></pre></div><h3 id=grpcroute-1>GRPCRoute<a class=td-heading-self-link href=#grpcroute-1 aria-label="Heading self-link"></a></h3><p>验证是否在没有 JWT 的情况下拒绝对 <code>yages</code> 服务的请求：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>grpcurl -plaintext -authority<span style=color:#ce5c00;font-weight:700>=</span>grpc-example.com <span style=color:#4e9a06>${</span><span style=color:#000>GATEWAY_HOST</span><span style=color:#4e9a06>}</span>:80 yages.Echo/Ping
</span></span></code></pre></div><p>您应该看到以下响应：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Error invoking method <span style=color:#4e9a06>&#34;yages.Echo/Ping&#34;</span>: rpc error: <span style=color:#000>code</span> <span style=color:#ce5c00;font-weight:700>=</span> Unauthenticated <span style=color:#000>desc</span> <span style=color:#ce5c00;font-weight:700>=</span> failed to query <span style=color:#204a87;font-weight:700>for</span> service descriptor <span style=color:#4e9a06>&#34;yages.Echo&#34;</span>: Jwt is missing
</span></span></code></pre></div><p>获取用于测试请求身份验证的 JWT：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#000>TOKEN</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>curl https://raw.githubusercontent.com/envoyproxy/gateway/main/examples/kubernetes/jwt/test.jwt -s<span style=color:#204a87;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;</span><span style=color:#000>$TOKEN</span><span style=color:#4e9a06>&#34;</span> <span style=color:#000;font-weight:700>|</span> cut -d <span style=color:#4e9a06>&#39;.&#39;</span> -f2 - <span style=color:#000;font-weight:700>|</span> base64 --decode
</span></span></code></pre></div><p>**注意：**上述命令解码并返回令牌的有效内容。您可以将 <code>f2</code> 替换为 <code>f1</code> 来查看令牌的标头。</p><p>验证是否允许使用有效 JWT 向 <code>yages</code> 服务发出请求：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>grpcurl -plaintext -H <span style=color:#4e9a06>&#34;authorization: Bearer </span><span style=color:#000>$TOKEN</span><span style=color:#4e9a06>&#34;</span> -authority<span style=color:#ce5c00;font-weight:700>=</span>grpc-example.com <span style=color:#4e9a06>${</span><span style=color:#000>GATEWAY_HOST</span><span style=color:#4e9a06>}</span>:80 yages.Echo/Ping
</span></span></code></pre></div><p>您应该看到以下响应：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;text&#34;</span>: <span style=color:#4e9a06>&#34;pong&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=clean-up>清理<a class=td-heading-self-link href=#clean-up aria-label="Heading self-link"></a></h2><p>按照<a href=../../quickstart>快速入门</a> 中的步骤卸载 Envoy Gateway 和示例清单。</p><p>删除 SecurityPolicy：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl delete securitypolicy/jwt-example
</span></span></code></pre></div><h2 id=next-steps>后续步骤<a class=td-heading-self-link href=#next-steps aria-label="Heading self-link"></a></h2><p>查看<a href=/eg-pr-preview/5-test-docs-preview/zh/contributions/develop/>开发者指南</a>参与该项目。</p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=邮件列表 aria-label=邮件列表><a target=_blank rel=noopener href=mailto:envoy-users@googlegroups.com aria-label=邮件列表><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=推特 aria-label=推特><a target=_blank rel=noopener href=https://twitter.com/EnvoyProxy aria-label=推特><i class="fab fa-twitter"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/envoyproxy/gateway aria-label=GitHub><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Slack aria-label=Slack><a target=_blank rel=noopener href=https://envoyproxy.slack.com/archives/C03E6NHLESV aria-label=Slack><i class="fab fa-slack"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2025
<span class=td-footer__authors>The Envoy Gateway Authors</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><p class="td-footer__about mt-2"><a href=/eg-pr-preview/5-test-docs-preview/zh/about/>关于 Envoy Gateway</a></p></div></div></div></footer></div><script src=/eg-pr-preview/5-test-docs-preview/js/main.min.69e2c1ae9320465ab10236d9ef752c6a4442c54b48b883b17c497b7c7d96a796.js integrity="sha256-aeLBrpMgRlqxAjbZ73UsakRCxUtIuIOxfEl7fH2Wp5Y=" crossorigin=anonymous></script><script defer src=/eg-pr-preview/5-test-docs-preview/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/eg-pr-preview/5-test-docs-preview/js/tabpane-persist.js></script></body></html>